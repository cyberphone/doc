<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

  <title>JSON Canonicalization Scheme (JCS) </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Detailed Operation">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Creation of JSON Data">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 JSON Canonicalization">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Whitespace Handling">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 Serialization of Primitive Data Types">
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 Sorting of Object Properties">
<link href="#rfc.section.3.2.4" rel="Chapter" title="3.2.4 UTF-8 Generation">
<link href="#rfc.section.4" rel="Chapter" title="4 IANA Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informal References">
<link href="#rfc.appendix.A" rel="Chapter" title="A ES6 Canonicalizer">
<link href="#rfc.appendix.B" rel="Chapter" title="B Sample Number Serializations">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.6 - https://tools.ietf.org/tools/xml2rfc">
  <link rel="schema.dct" href="http://purl.org/dc/terms/">

  <meta name="dct.creator" content="Rundgren, A.">
  <meta name="dct.identifier" content="urn:ietf:id:draft-rundgren-json-canonicalization-scheme-00">
  <meta name="dct.issued" scheme="ISO8601" content="2018-15">
  <meta name="dct.abstract" content="Cryptographic operations like hashing and signing depend on that the target data does not change during serialization, transport, or parsing.  By applying the rules defined by JCS (JSON Canonicalization Scheme), data provided in the JSON ">
  <meta name="description" content="Cryptographic operations like hashing and signing depend on that the target data does not change during serialization, transport, or parsing.  By applying the rules defined by JCS (JSON Canonicalization Scheme), data provided in the JSON ">

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">A. Rundgren</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Independent</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">March 15, 2018</td>
</tr>
<tr>
<td class="left">Expires: September 16, 2018</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">JSON Canonicalization Scheme (JCS) <br>
  <span class="filename">draft-rundgren-json-canonicalization-scheme-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Cryptographic operations like hashing and signing depend on that the 
target data does not change during serialization, transport, or parsing.
  By applying the rules defined by JCS (JSON Canonicalization Scheme), 
data provided in the JSON <a href="#RFC8259" class="xref">[RFC8259]</a> 
format can be exchanged "as is", while still being subject to secure 
cryptographic operations.  JCS achieves this by exploiting the strict 
operation of the JSON serialization method defined in ECMAScript 
beginning with version 6 <a href="#ES6" class="xref">[ES6]</a>.  </p>
<p>The intended audiences of this document are JSON tool vendors, as well as designers of JSON based cryptographic solutions.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering 
Task Force (IETF).  Note that other groups may also distribute working 
documents as Internet-Drafts.  The list of current Internet-Drafts is at
 https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months
 and may be updated, replaced, or obsoleted by other documents at any 
time.  It is inappropriate to use Internet-Drafts as reference material 
or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 16, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal 
Provisions Relating to IETF Documents 
(https://trustee.ietf.org/license-info) in effect on the date of 
publication of this document.  Please review these documents carefully, 
as they describe your rights and restrictions with respect to this 
document.  Code Components extracted from this document must include 
Simplified BSD License text as described in Section 4.e of the Trust 
Legal Provisions and are provided without warranty as described in the 
Simplified BSD License.</p>

  
  <hr class="noprint">
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Detailed Operation</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Creation of JSON Data</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">JSON Canonicalization</a>
</li>
<ul><li>3.2.1.   <a href="#rfc.section.3.2.1">Whitespace Handling</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">Serialization of Primitive Data Types</a>
</li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">Sorting of Object Properties</a>
</li>
<li>3.2.4.   <a href="#rfc.section.3.2.4">UTF-8 Generation</a>
</li>
</ul></ul><li>4.   <a href="#rfc.section.4">IANA Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<ul><li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informal References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">ES6 Canonicalizer</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Sample Number Serializations</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Cryptographic operations like hashing and 
signing depend on that the target data does not change during 
serialization, transport, or parsing.  A straightforward way of 
accomplishing this is converting the data into a format which has a 
simple and fixed representation like Base64Url <a href="#RFC4648" class="xref">[RFC4648]</a> which for example have been used in JWS <a href="#RFC7515" class="xref">[RFC7515]</a>.  Another solution is creating a canonicalized version of the target data with XML Signature <a href="#XMLDSIG" class="xref">[XMLDSIG]</a> as a prime example.  </p>
<p id="rfc.section.1.p.2">Since the desire here was keeping the data "as
 is", the canonicalization method was selected.  For reasons outlined in
 this document, JCS also depends on JSON serialization compatible with 
ECMAScript (aka JavaScript) version 6 <a href="#ES6" class="xref">[ES6]</a>, from now on simply referred to as "ES6".  </p>
<p id="rfc.section.1.p.3">Seasoned XML developers recalling difficulties
 getting signatures to validate (due to different interpretations of the
 quite intricate XML canonicalization rules as well as of the equally 
extensive Web Services security standards), may rightfully wonder why 
this particular effort would succeed. The reasons are twofold: </p>

<ol>
<li>JSON is a considerably simpler format than XML, as well as lacking support for the powerful (but complex) namespace concept.</li>
<li>ES6 compatible JSON serialization is already supported by most Web browsers, Node.js <a href="#NODEJS" class="xref">[NODEJS]</a>, as well as by third party libraries like Open&nbsp;Keystore <a href="#OPENKEY" class="xref">[OPENKEY]</a> giving the proposed canonicalization scheme a head start.  </li>
</ol>

<p> </p>
<p id="rfc.section.1.p.4">The JCS specification describes how JSON 
serializing rules compliant with ES6, can be used for supporting 
"Crypto&nbsp;Safe" JSON.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#Terminology" id="Terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", 
"SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT 
RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be 
interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#Operation" id="Operation">Detailed Operation</a>
</h1>
<p id="rfc.section.3.p.1">This section describes the different issues related to JSON canonicalization, and how they are addressed by JCS.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#json.datacreation" id="json.datacreation">Creation of JSON Data</a>
</h1>
<p id="rfc.section.3.1.p.1">In order to canonicalize JSON data, an internal representation of the JSON data is needed.  This can be performed by: </p>

<ul>
<li>Parsing externally supplied JSON data which MUST conform to <a href="#RFC8259" class="xref">[RFC8259]</a>.  </li>
<li>Creating JSON data programmatically.  </li>
</ul>

<p> Irrespective of method used, the internal representation of JSON data MUST be compatible with ES6 which means that: </p>

<ul>
<li>There MUST NOT be any duplicate property names within an <samp>Object</samp>.  </li>
<li>Data of the type <samp>String</samp> MUST be expressible as UNICODE <a href="#UNICODE" class="xref">[UNICODE]</a> strings.  </li>
<li>Data of the type <samp>Number</samp> MUST be expressible as IEEE-754 <a href="#IEEE754" class="xref">[IEEE754]</a> double precision values.  <br><br> Note: If the target system offers higher precision, this MUST NOT be utilized when serializing the <samp>Number</samp> type.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#json.canonicalization" id="json.canonicalization">JSON Canonicalization</a>
</h1>
<p id="rfc.section.3.2.p.1">The following sub sections describe all the 
steps needed in order to create a canonicalized version of internal JSON
 data elaborated on in the previous section.  </p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#json.whitespace" id="json.whitespace">Whitespace Handling</a>
</h1>
<p id="rfc.section.3.2.1.p.1">Whitespace between elements MUST NOT be emitted when JCS is targeted.  </p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#json.serialization.data" id="json.serialization.data">Serialization of Primitive Data Types</a>
</h1>
<p id="rfc.section.3.2.2.p.1">Assume that you parse a JSON object like the following: </p>
<pre>  {
    "escaping": "\u20ac$\u000F\u000aA'\u0042\u0022\u005c\\\"\/",
    "other":  [null, true, false],
    "numbers": [1E30,4.50,6,2e-3,0.000000000000000000000000001]
  }</pre>
<p></p>
<p id="rfc.section.3.2.2.p.3">If you subsequently serialize the object created by the operation above using an serializer compliant with ES6's <samp>JSON.stringify()</samp>, the result would (with a line wrap added for display purposes only), be rather divergent with respect to data representation: </p>
<pre>  {"escaping":"\u20ac$\u000f\nA'B\"\\\\\"/","other":[null,true,
  false],"numbers":[1e+30,4.5,6,0.002,1e-27]}</pre>
<p></p>
<p></p>

<ul class="empty"><li>Note: \u20ac denotes the Euro character, which not <br> being ASCII, is currently not displayable in RFCs.  </li></ul>

<p> </p>
<p id="rfc.section.3.2.2.p.6">The reason for the huge difference between
 the parsed data and its serialized counterpart, is due to a wider 
tolerance on input data (as defined by <a href="#RFC8259" class="xref">[RFC8259]</a>) than on output data (as defined by ES6).  <br><br> For serializing primitive JSON data types according to JCS (which fully relies on the ES6 scheme), the following rules apply: </p>

<ul>
<li>The literals <samp>null</samp>, <samp>true</samp>, and <samp>false</samp> present no challenge since they already have a fixed definition in JSON <a href="#RFC8259" class="xref">[RFC8259]</a>.  </li>
<li>For data of the type <samp>String</samp> (which includes property names as well), each character MUST be serialized as described in Section <a href="#ES6" class="xref">24.3.2.2</a> of ES6.  <br><br>
 If the Unicode value falls within the traditional ASCII control 
character range (0x0000-0x001f), it MUST be serialized using lowercase 
hexadecimal Unicode notation (\uhhhh) unless it is in the set of 
predefined JSON control characters 0x0008, 0x0009, 0x000a, 0x000c or 
0x000d which MUST be serialized as \b, \t, \n, \f and \r respectively.  <br><br>
 If the Unicode value is outside of the ASCII control character range, 
it MUST be serialized "as&nbsp;is" unless it is equivalent to 
0x005c&nbsp;(\) or 0x0022&nbsp;(") which MUST be serialized as \\ and \"
 respectively.  </li>
<li>Data of the type <samp>Number</samp>, MUST be serialized according to Section <a href="#ES6" class="xref">7.1.12.1</a>
 of ES6; for maximum interoperability preferably including the "Note 2" 
enhancement as well.  The latter is implemented by for example Google's 
V8 <a href="#V8" class="xref">[V8]</a>.  <br><br> Due to the relative complexity of this part, it is not included in this specification.  <br><br> Note that ES6 builds on the IEEE-754 <a href="#IEEE754" class="xref">[IEEE754]</a> double precision standard for storing <samp>Number</samp>
 data.  If the target JSON system uses another format it may be 
difficult achieving full interoperability with respect to numeric data. 
 <br><br> <a href="#ieee754.test" class="xref">Appendix B</a> holds a set of test values.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.3.2.3">
<a href="#rfc.section.3.2.3">3.2.3.</a> <a href="#json.sorting.properties" id="json.sorting.properties">Sorting of Object Properties</a>
</h1>
<p id="rfc.section.3.2.3.p.1">Although the previous step indeed 
normalized the representation of primitive data types, the result would 
not qualify as "canonicalized" since the properties are not in lexical 
(alphabetical) order.  <br><br> Applied to the sample in <a href="#json.serialization.data" class="xref">Section 3.2.2</a>, a properly canonicalized version should (with a line wrap added for display purposes only), read as: </p>
<pre>  {"escaping":"\u20ac$\u000f\nA'B\"\\\\\"/","numbers":[1e+30,
  4.5,6,0.002,1e-27],"other":[null,true,false]}</pre>
<p></p>
<p></p>

<ul class="empty"><li>Note: \u20ac denotes the Euro character, which not <br> being ASCII, is currently not displayable in RFCs.  </li></ul>

<p> </p>
<p id="rfc.section.3.2.3.p.4">The rules for lexical sorting of JSON properties according to JCS are as follows: </p>

<ul>
<li>Properties are sorted in a recursive manner which means that a found JSON child <samp>Object</samp> type MUST be subject to sorting as well.  </li>
<li>JSON <samp>Array</samp> data MUST also be checked for the presence of sortable JSON <samp>Object</samp> elements, but array element order MUST NOT be changed.  </li>
</ul>

<p> </p>
<p id="rfc.section.3.2.3.p.5">When a JSON <samp>Object</samp> is about to have its properties sorted, the following measures MUST be performed: </p>

<ul>
<li>Property strings to be sorted depend on that strings are represented
 as arrays of 16-bit unsigned integers where each integer holds a single
 UCS2/UTF-16 <a href="#UNICODE" class="xref">[UNICODE]</a> code unit.  The sorting is based on pure value comparisons, independent of locale settings.  </li>
<li>Property strings either have different characters at some index that
 is a valid index for both strings, or their lengths are different, or 
both.  If they have different characters at one or more index positions,
 let k be the smallest such index; then the string whose character at 
position k has the smaller value, as determined by using the &lt; 
operator, lexically precedes the other string.  <br><br> If there is no index position at which they differ, then the shorter string lexically precedes the longer string.  </li>
</ul>

<p> </p>
<p><a href="#canonicalize.js" class="xref">Appendix A</a> shows the code for an ES6 based canonicalizer, compatible with this specification.  </p>
<h1 id="rfc.section.3.2.4">
<a href="#rfc.section.3.2.4">3.2.4.</a> <a href="#json.utf8" id="json.utf8">UTF-8 Generation</a>
</h1>
<p id="rfc.section.3.2.4.p.1">Finally, the resulting string data MUST be converted into an UTF-8 formatted array.  <br><br> Applied to the sample in <a href="#json.sorting.properties" class="xref">Section 3.2.3</a> this should yield the following bytes here shown in hexadecimal notation: </p>
<pre>  7b 22 65 73 63 61 70 69 6e 67 22 3a 22 e2 82 ac 24 5c 75 30
  30 30 66 5c 6e 41 27 42 5c 22 5c 5c 5c 5c 5c 22 2f 22 2c 22
  6e 75 6d 62 65 72 73 22 3a 5b 31 65 2b 33 30 2c 34 2e 35 2c
  36 2c 30 2e 30 30 32 2c 31 65 2d 32 37 5d 2c 22 6f 74 68 65
  72 22 3a 5b 6e 75 6c 6c 2c 74 72 75 65 2c 66 61 6c 73 65 5d
  7d</pre>
<p></p>
<p id="rfc.section.3.2.4.p.3">This data is intended to be usable as interoperable input to cryptographic functions.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.4.p.1">This document has no IANA actions.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">JSON parsers MUST check that input data conforms to the JSON <a href="#RFC8259" class="xref">[RFC8259]</a> specification.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.6.p.1">Building on ES6 number normalization was 
originally proposed by James Manger. This ultimately led to the adoption
 of the entire ES6 JSON processing model.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="ES6">[ES6]</b></td>
<td class="top">
<a>Ecma International</a>, "<a href="https://www.ecma-international.org/ecma-262/6.0/index.html">ECMAScript 2015 Language Specification</a>"</td>
</tr>
<tr>
<td class="reference"><b id="IEEE754">[IEEE754]</b></td>
<td class="top">
<a>IEEE</a>, "<a href="http://grouper.ieee.org/groups/754/">IEEE Standard for Floating-Point Arithmetic</a>", August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8259">[RFC8259]</b></td>
<td class="top">
<a>Bray, T.</a>, "<a href="https://tools.ietf.org/html/rfc8259">The JavaScript Object Notation (JSON) Data Interchange Format</a>", STD 90, RFC 8259, DOI 10.17487/RFC8259, December 2017.</td>
</tr>
<tr>
<td class="reference"><b id="UNICODE">[UNICODE]</b></td>
<td class="top">
<a>The Unicode Consortium</a>, "<a href="https://www.unicode.org/versions/Unicode10.0.0/">The Unicode Standard, Version 10.0.0</a>"</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informal References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="NODEJS">[NODEJS]</b></td>
<td class="top">"<a href="https://nodejs.org/">Node.js</a>"</td>
</tr>
<tr>
<td class="reference"><b id="OPENKEY">[OPENKEY]</b></td>
<td class="top">"<a href="https://github.com/cyberphone/openkeystore">Open Keystore</a>"</td>
</tr>
<tr>
<td class="reference"><b id="RFC4648">[RFC4648]</b></td>
<td class="top">
<a>Josefsson, S.</a>, "<a href="https://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, DOI 10.17487/RFC4648, October 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7515">[RFC7515]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="V8">[V8]</b></td>
<td class="top">
<a>Google LLC</a>, "<a href="https://developers.google.com/v8/">Chrome V8 Open Source JavaScript Engine</a>"</td>
</tr>
<tr>
<td class="reference"><b id="XMLDSIG">[XMLDSIG]</b></td>
<td class="top">
<a>W3C</a>, "<a href="https://www.w3.org/TR/xmldsig-core1/">XML Signature Syntax and Processing Version 1.1</a>"</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#canonicalize.js" id="canonicalize.js">ES6 Canonicalizer</a>
</h1>
<p id="rfc.section.A.p.1">Below is a functionally complete example of a JCS compliant canonicalizer for usage with ES6 based systems.  </p>
<pre>var canonicalize = function(object) {

    var buffer = '';
    serialize(object);
    return buffer;

    function serialize(object) {
        if (object !== null &amp;&amp; typeof object === 'object') {
            if (Array.isArray(object)) {
                buffer += '[';
                let next = false;
                // Array - Maintain element order
                object.forEach((element) =&gt; {
                    if (next) {
                        buffer += ',';
                    }
                    next = true;
                    // Recursive call
                    serialize(element);
                });
                buffer += ']';
            } else {
                buffer += '{';
                let next = false;
                // Object - Sort properties before serializing
                Object.keys(object).sort().forEach((property) =&gt; {
                    if (next) {
                        buffer += ',';
                    }
                    next = true;
                    // Properties are just strings - Use ES6
                    buffer += JSON.stringify(property);
                    buffer += ':';
                    // Recursive call
                    serialize(object[property]);
                });
                buffer += '}';
            }
        } else {
            // Primitive data type - Use ES6
            buffer += JSON.stringify(object);
        }
    }
};</pre>
<p></p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#ieee754.test" id="ieee754.test">Sample Number Serializations</a>
</h1>
<p id="rfc.section.B.p.1">The following table holds a set of ES6 <samp>Number</samp> serializations including some edge cases.  The field  "ES6&nbsp;Internal" refers to the internal ES6 representation of the <samp>Number</samp> data type which is based on the IEEE-754 <a href="#IEEE754" class="xref">[IEEE754]</a> standard using 64-bit (double precision) values, here expressed in hexadecimal.  </p>
<pre>|=================================================================|
|   ES6 Internal   |   JSON Representation    |      Comment      |
|=================================================================|
| 0000000000000000 | 0                        | Zero              |
|-----------------------------------------------------------------|
| 8000000000000000 | 0                        | Minus zero        |
|-----------------------------------------------------------------|
| 0000000000000001 | 5e-324                   | Smallest positive |
|-----------------------------------------------------------------|
| 8000000000000001 | -5e-324                  | Smallest negative |
|-----------------------------------------------------------------|
| 7fefffffffffffff | 1.7976931348623157e+308  | Largest positive  |
|-----------------------------------------------------------------|
| ffefffffffffffff | -1.7976931348623157e+308 | Largest negative  |
|-----------------------------------------------------------------|
| 7fffffffffffffff |                          | Error (NaN)       |
|-----------------------------------------------------------------|
| 7ff0000000000000 |                          | Error (Infinity)  |
|-----------------------------------------------------------------|
| 44b52d02c7e14af5 | 9.999999999999997e+22    |                   |
|-----------------------------------------------------------------|
| 44b52d02c7e14af6 | 1e+23                    |                   |
|-----------------------------------------------------------------|
| 44b52d02c7e14af7 | 1.0000000000000001e+23   |                   |
|-----------------------------------------------------------------|
| 444b1ae4d6e2ef4e | 999999999999999700000    |                   |
|-----------------------------------------------------------------|
| 444b1ae4d6e2ef4f | 999999999999999900000    |                   |
|-----------------------------------------------------------------|
| 444b1ae4d6e2ef50 | 1e+21                    |                   |
|-----------------------------------------------------------------|
| 444b1ae4d6e2ef51 | 1.0000000000000001e+21   |                   |
|-----------------------------------------------------------------|
| 41b3de4355555553 | 333333333.3333332        |                   |
|-----------------------------------------------------------------|
| 41b3de4355555554 | 333333333.33333325       |                   |
|-----------------------------------------------------------------|
| 41b3de4355555555 | 333333333.3333333        |                   |
|-----------------------------------------------------------------|
| 41b3de4355555556 | 333333333.3333334        |                   |
|-----------------------------------------------------------------|
| 41b3de4355555557 | 333333333.33333343       |                   |
|-----------------------------------------------------------------|</pre>
<p></p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Anders Rundgren</span> 
	  <span class="n hidden">
		<span class="family-name">Rundgren</span>
	  </span>
	</span>
	<span class="org vcardline">Independent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Montpellier</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:anders.rundgren.net@gmail.com">anders.rundgren.net@gmail.com</a></span>

  </address>
</div>



</body></html>