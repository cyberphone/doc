<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

  <title>Cleartext JSON Web Signature (JWS) </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 The Signature Object">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Signature Scope">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 The &quot;signature&quot; Header Parameter">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 The &quot;signers&quot; Header Parameter">
<link href="#rfc.section.4" rel="Chapter" title="4 Producing and Consuming Cleartext JWSs">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Message Signature or MAC Computation">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Message Signature or MAC Validation">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Multiple Signatures">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 JSON Header Parameters Registry">
<link href="#rfc.section.5.1.1" rel="Chapter" title="5.1.1 Registry Contents">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Test Vectors">
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 Multiple Signatures with Top-Level &quot;alg&quot; Header Parameter">
<link href="#rfc.appendix.A.2" rel="Chapter" title="A.2 Multiple Signatures with Top-Level &quot;crit&quot; Header Parameter">
<link href="#rfc.appendix.A.3" rel="Chapter" title="A.3 Elliptic Curve Key &quot;example.com:p256&quot;">
<link href="#rfc.appendix.A.4" rel="Chapter" title="A.4 Elliptic Curve Key &quot;example.com:p384&quot;">
<link href="#rfc.appendix.A.5" rel="Chapter" title="A.5 RSA Key &quot;example.com:r2048&quot;">
<link href="#rfc.appendix.B" rel="Chapter" title="B Acknowledgements">
<link href="#rfc.appendix.C" rel="Chapter" title="C Open Issues">
<link href="#rfc.appendix.D" rel="Chapter" title="D Document History">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.6 - https://tools.ietf.org/tools/xml2rfc">
  <link rel="schema.dct" href="http://purl.org/dc/terms/">

  <meta name="dct.creator" content="Rundgren, A.">
  <meta name="dct.identifier" content="urn:ietf:id:draft-rundgren-jose-cleartext-jws-00">
  <meta name="dct.issued" scheme="ISO8601" content="2018-16">
  <meta name="dct.abstract" content="Cleartext JSON Web Signature (JWS) is a means of signing JSON objects directly without representing the JSON to be signed in a non-JSON representation, such as base64url-encoded JSON.  The signature and information about the signature is added to the JSON object when it is signed.  The signature calculation for signing the JSON object relies on the JSON canoninicalization scheme defined by JCS ">
  <meta name="description" content="Cleartext JSON Web Signature (JWS) is a means of signing JSON objects directly without representing the JSON to be signed in a non-JSON representation, such as base64url-encoded JSON.  The signature and information about the signature is added to the JSON object when it is signed.  The signature calculation for signing the JSON object relies on the JSON canoninicalization scheme defined by JCS ">

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">JSON Object Signing and Encryption (JOSE)</td>
<td class="right">A. Rundgren</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Independent</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">April 16, 2018</td>
</tr>
<tr>
<td class="left">Expires: October 18, 2018</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Cleartext JSON Web Signature (JWS) <br>
  <span class="filename">draft-rundgren-jose-cleartext-jws-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Cleartext JSON Web Signature (JWS) is a means of signing JSON objects
 directly without representing the JSON to be signed in a non-JSON 
representation, such as base64url-encoded JSON.  The signature and 
information about the signature is added to the JSON object when it is 
signed.  The signature calculation for signing the JSON object relies on
 the JSON canoninicalization scheme defined by JCS <a href="#JCS" class="xref">[JCS]</a>.
  Cleartext JWS builds on the JWS, JWA, and JWK specifications, reusing 
data structures and semantics from these specifications, where 
applicable.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering 
Task Force (IETF).  Note that other groups may also distribute working 
documents as Internet-Drafts.  The list of current Internet-Drafts is at
 https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months
 and may be updated, replaced, or obsoleted by other documents at any 
time.  It is inappropriate to use Internet-Drafts as reference material 
or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 18, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal 
Provisions Relating to IETF Documents 
(https://trustee.ietf.org/license-info) in effect on the date of 
publication of this document.  Please review these documents carefully, 
as they describe your rights and restrictions with respect to this 
document.  Code Components extracted from this document must include 
Simplified BSD License text as described in Section 4.e of the Trust 
Legal Provisions and are provided without warranty as described in the 
Simplified BSD License.</p>

  
  <hr class="noprint">
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">The Signature Object</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Signature Scope</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">The "signature" Header Parameter</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">The "signers" Header Parameter</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Producing and Consuming Cleartext JWSs</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Message Signature or MAC Computation</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Message Signature or MAC Validation</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Multiple Signatures</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">JSON Header Parameters Registry</a>
</li>
<ul><li>5.1.1.   <a href="#rfc.section.5.1.1">Registry Contents</a>
</li>
</ul></ul><li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<ul><li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Test Vectors</a>
</li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">Multiple Signatures with Top-Level "alg" Header Parameter</a>
</li>
<li>A.2.   <a href="#rfc.appendix.A.2">Multiple Signatures with Top-Level "crit" Header Parameter</a>
</li>
<li>A.3.   <a href="#rfc.appendix.A.3">Elliptic Curve Key "example.com:p256"</a>
</li>
<li>A.4.   <a href="#rfc.appendix.A.4">Elliptic Curve Key "example.com:p384"</a>
</li>
<li>A.5.   <a href="#rfc.appendix.A.5">RSA Key "example.com:r2048"</a>
</li>
</ul><li>Appendix B.   <a href="#rfc.appendix.B">Acknowledgements</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.C">Open Issues</a>
</li>
<li>Appendix D.   <a href="#rfc.appendix.D">Document History</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Cleartext JSON Web Signature (JWS) represents a signed JSON object directly as a JSON object <a href="#RFC8259" class="xref">[RFC8259]</a>,
 without representing the JSON to be signed in a non-JSON 
representation, such as base64url-encoded JSON.  The signature and 
information about the signature is added to the JSON object when it is 
signed.  The signature calculation for signing the JSON object on the 
JSON canoninicalization scheme defined by JCS <a href="#JCS" class="xref">[JCS]</a>.
  By including the signature information in the JSON object to be 
signed, it is easy to inspect data in transit and when archived, 
integrity can be guaranteed.  </p>
<p id="rfc.section.1.p.2">Cleartext JWS builds on the JWS <a href="#RFC7515" class="xref">[RFC7515]</a>, JWA <a href="#RFC7518" class="xref">[RFC7518]</a>, and JWK <a href="#RFC7517" class="xref">[RFC7517]</a>
 specifications, reusing data structures and semantics from these 
specifications, where applicable.  Cryptographic algorithm identifiers 
used by this specification come from the IANA "JSON Web Signature and 
Encryption Algorithms" registry <a href="#IANA.JOSE.Algorithms" class="xref">[IANA.JOSE.Algorithms]</a>.  </p>
<p id="rfc.section.1.p.3">There are three essential differences between Cleartext JWS and JWS: </p>

<ul>
<li>Cleartext JWS can only sign JSON objects, rather than arbitrary data.  </li>
<li>Cleartext JWS signature information is included within the signed data.  </li>
<li>Cleartext JWS depends on canonicalized JSON data, rather than base64url-encoding the data to be signed.  </li>
</ul>

<p> </p>
<p id="rfc.section.1.p.4">The table below is a comparison of JWS and Cleartext JWS: </p>
<table class="tt full center" cellspacing="0" cellpadding="3">
<thead><tr>
<th class="left"></th>
<th class="left">JWS</th>
<th class="left">Cleartext JWS</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Data&nbsp;to&nbsp;be&nbsp;Signed</td>
<td class="left">Arbitrary&nbsp;data</td>
<td class="left">JSON or JavaScript objects </td>
</tr>
<tr>
<td class="left">Encoding&nbsp;of&nbsp;Signed&nbsp;Data</td>
<td class="left">Base64url</td>
<td class="left">None</td>
</tr>
<tr>
<td class="left">Encoding&nbsp;of&nbsp;Header&nbsp;Parameters</td>
<td class="left">Base64url</td>
<td class="left">None</td>
</tr>
<tr>
<td class="left">URL Friendly</td>
<td class="left">Core&nbsp;feature</td>
<td class="left">Out of scope</td>
</tr>
</tbody>
</table>
<p id="rfc.section.1.p.5">In the following example, note that the signature information is included in the JSON object.  The members in the <samp>__cleartext_signature</samp> object are the JWS Header Parameters for the signature.  The <samp>signature</samp> member contains the base64url-encoded signature value.  (Line breaks within values are for display purposes only.) </p>
<pre>{
  "iss": "joe",
  "exp": 1300819380,
  "__cleartext_signature": {
    "alg": "ES256",
    "kid": "example.com:p256",
    "signature": "pXP0GFHms0SntctNk1G1pHZfccVYdZkmAJktY_hpMsI
                  AckzX7wZJIJNlsBzmJ1_7LmKATiW-YHHZjsYdT96JZw"
  }
}</pre>
<p></p>
<p id="rfc.section.1.p.7">The key in <a href="#example.com:p256" class="xref">Appendix A.3</a> can be used for verifying the example signature.  </p>
<p id="rfc.section.1.p.8">Note: Recreating the example signature using the example private key would normally result in a different <samp>signature</samp> value since ECDSA includes random data in the signature calculation.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", 
"SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT 
RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be 
interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#SignatureObject" id="SignatureObject">The Signature Object</a>
</h1>
<p id="rfc.section.3.p.1">When signing JSON data with Cleartext JWS, a 
JSON object with the JWS Header Parameters is created and placed within 
the JSON data to be signed. In addition to the already defined JWS 
Header Parameters, Cleartext JWS defines two new Header Parameters: <samp>signature</samp> for the base64url-encoded signature value and <samp>signers</samp> to support multiple signers within the same signature object.  </p>
<p id="rfc.section.3.p.2">The identifier for the Cleartext Signature Object in the JSON data to be signed MUST be <samp>__cleartext_signature</samp>, unless the application specifies that a different identifier is to be used.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#SignatureScope" id="SignatureScope">Signature Scope</a>
</h1>
<p id="rfc.section.3.1.p.1">The scope of a signature (the data that is 
actually signed) comprises all values including child objects of the 
signature object except for the <samp>signature</samp> member.  If 
multiple signers are present, only the data pertaining to all signers 
and the data specific to that signer are included (but not the data 
specific to other signers).  See <a href="#MultipleSignatures" class="xref">Section 4.3</a> for more about the multiple signatures case.  </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#SignatureHeaderParameter" id="SignatureHeaderParameter">The "signature" Header Parameter</a>
</h1>
<p id="rfc.section.3.2.p.1">The <samp>signature</samp> Header Parameter contains the base64url-encoded JWS Signature as a string.  </p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#SignersHeaderParameter" id="SignersHeaderParameter">The "signers" Header Parameter</a>
</h1>
<p id="rfc.section.3.3.p.1">The optional <samp>signers</samp> Header Parameter contains an array of sets of Header Parameters that are specific to each signer, including the <samp>signature</samp> value for each signer.  See <a href="#MultipleSignatures" class="xref">Section 4.3</a> for more about the multiple signatures case.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#ProducingConsumingCleartextJWSs" id="ProducingConsumingCleartextJWSs">Producing and Consuming Cleartext JWSs</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#MessageSignatureMACComputation" id="MessageSignatureMACComputation">Message Signature or MAC Computation</a>
</h1>
<p id="rfc.section.4.1.p.1">To create a Cleartext JWS, the following 
steps are performed.  The order of the steps is not significant in cases
 where there are no dependencies between the inputs and outputs of the 
steps.  </p>
<p></p>

<ol>
<li>Create the JSON object to be signed.  </li>
<li>Create the <samp>__cleartext_signature</samp> object with the Header Parameters to be used and add it as a top-level member to the object to be signed with the key <samp>__cleartext_signature</samp>.  </li>
<li>Serialize the object to be signed using the serialization defined in JCS <a href="#JCS" class="xref">[JCS]</a>.  </li>
<li>Compute the JWS Signature in the manner defined for the particular 
algorithm being used over the serialized object to be signed. The <samp>alg</samp> (algorithm) Header Parameter MUST be present in the <samp>__cleartext_signature</samp> member, with the algorithm value accurately representing the algorithm used to construct the JWS Signature.  </li>
<li>Add the <samp>signature</samp> member to the signature object with the value BASE64URL(JWS Signature).  </li>
</ol>

<p> </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#MessageSignatureMACValidation" id="MessageSignatureMACValidation">Message Signature or MAC Validation</a>
</h1>
<p id="rfc.section.4.2.p.1">When validating a Cleartext JWS, the 
following steps are performed.  The order of the steps is not 
significant in cases where there are no dependencies between the inputs 
and outputs of the steps.  If any of the listed steps fails, then the 
input MUST be rejected.  </p>
<p id="rfc.section.4.2.p.2">When there are multiple JWS Signature 
values, it is an application decision which of the JWS Signature values 
must successfully validate for the Cleartext JWS to be accepted.  In 
some cases, all must successfully validate, or the Cleartext JWS will be
 considered invalid.  In other cases, only a specific JWS Signature 
value needs to be successfully validated.  However, in all cases, at 
least one JWS Signature value MUST successfully validate, or the 
Cleartext JWS MUST be considered invalid.  </p>
<p></p>

<ol>
<li>Parse the JSON data, including the signature object.  </li>
<li>Verify that the implementation understands and can process all 
fields that it is required to support, whether required by this 
specification, by the algorithm being used, or by the <samp>crit</samp> Header Parameter value, and that the values of those parameters are also understood and supported.  </li>
<li>Save and remove the <samp>signature</samp> member from the signature object and base64url-decode the encoded representation of the JWS Signature.  </li>
<li>Serialize the signed object, including the signature object, by following the rules in JCS <a href="#JCS" class="xref">[JCS]</a>.  </li>
<li>Validate the JWS Signature against the JWS Signing Input, i.e., the 
serialized data, in the manner defined for the algorithm being used, 
which MUST be accurately represented by the value of the <samp>alg</samp> (algorithm) Header Parameter value, which MUST be present. Record whether the validation succeeded or not.  </li>
<li>Return a result indicating whether or not the Cleartext JWS was successfully validated.  </li>
<li>For later validation of the signed object, put the <samp>signature</samp> member back into the JSON data structure.  </li>
</ol>

<p> </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#MultipleSignatures" id="MultipleSignatures">Multiple Signatures</a>
</h1>
<p id="rfc.section.4.3.p.1">Multiple signers using different keys can 
independently add signatures to a JSON object in the manner described in
 this section.  </p>
<p id="rfc.section.4.3.p.2">The signature procedure is essentially the same as for single signatures but also includes the following: </p>

<ul>
<li>There MUST be an additional JWS Header parameter <samp>signers</samp>, holding an array of signature constructs.  </li>
<li>Each signature requires its own serialization process. During this 
process, the signature constructs for other signatures MUST be 
(temporarily) removed.  </li>
<li>The serialized data in the <samp>signers</samp> value MUST include 
the array brackets ([]) containing the data specific to this signature 
but MUST NOT include the data for other signatures.  The resulting array
 will be single-valued, with no commas separating additional elements.  </li>
<li>A given Header Parameter MUST NOT occur in both the top-level signature object and a signature object within the <samp>signers</samp> value.  Any Header Parameter occurring in the top-level signature object applies to all signatures.  </li>
<li>A signature construct is equivalent to an ordinary signature object, but MAY exclude the <samp>alg</samp>
 Header parameter if it is present in the top-level signature object 
itself.  If in the top-level signature object, all enclosed signature 
constructs MUST use the same algorithm as well as not including the <samp>alg</samp> Header parameter.  See <a href="#multipleglobalalg" class="xref">Appendix A.1</a> for an example.  </li>
<li>Likewise, if a <samp>crit</samp> Header parameter is specified in 
the top-level signature object, it is be applied to all signature 
constructs and MUST NOT be present in them individually.  See <a href="#multipleglobalcrit" class="xref">Appendix A.2</a> for an example.  </li>
</ul>

<p> </p>
<p id="rfc.section.4.3.p.3">The following example shows a multiply signed object: </p>
<pre>{
  "iss": "joe",
  "exp": 1300819380,
  "__cleartext_signature": {
    "signers": [{
      "alg": "ES256",
      "kid": "example.com:p256",
      "signature": "83gr5rmjKgngLTaPpxuQWiZaQmlQ555jLHNcZLmcBpg
                    X7JZLeqrNhIrQRg3jTsNwh1RuibDYBzCsaxVUkhGEKg"
    },{
      "alg": "RS256",
      "kid": "example.com:r2048",
      "signature": "PVQeL8XtjnetambQe98FuMBDuijwWTIFXouyNjL8WX0
                    WvamWkHjv34Iz8VOHHWr9w8t14FXJJuQ22j-h5BR7qP
                    xE7cBVS8XSltR7VvcNidfn-r-TtAVwDwn7Iz_Gk-RI7
                    QIv4ctbreYt1myG64Ikw38OEmNURCxzf9h9w3tvA3R8
                    ZE3MYgELFaQRowSW92JC1HhGZRijzHoIzvH6l_GULP_
                    hf7kggwFNtRrzN8DLXbhBhGaoP-O0cNZsCWY2hbNU6L
                    7km6bdrqHdq88DSOEGg_-5T6qUsIAYbmCgUK7XBi2q-
                    DRPQZYnxr5570mj9Nkh0hpZ-VfAC2ftbzxFAB7ZYg"
    }]
  }
}</pre>
<p></p>
<p id="rfc.section.4.3.p.5">The ECDSA signature can be validated using the key in <a href="#example.com:p256" class="xref">Appendix A.3</a> and the RSA signature can be validated using the key in <a href="#example.com:r2048" class="xref">Appendix A.5</a>.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#IANAJSONHeaderParametersRegistry" id="IANAJSONHeaderParametersRegistry">JSON Header Parameters Registry</a>
</h1>
<p id="rfc.section.5.1.p.1">This section registers the following Header 
Parameters in the IANA "JSON Web Signature and Encryption Header 
Parameters" registry <a href="#IANA.JOSE.HeaderParameters" class="xref">[IANA.JOSE.HeaderParameters]</a>.  </p>
<h1 id="rfc.section.5.1.1">
<a href="#rfc.section.5.1.1">5.1.1.</a> <a href="#IANAJSONHeaderParametersRegistryContents" id="IANAJSONHeaderParametersRegistryContents">Registry Contents</a>
</h1>
<p></p>

<ul>
<li>Header Parameter Name: <samp>signature</samp>
</li>
<li>Header Parameter Description: The base64url-encoded signature value</li>
<li>Header Parameter Usage Location(s): <samp>Cleartext JWS</samp>
</li>
<li>Change Controller: IESG</li>
<li>Specification Document(s): <a href="#SignatureHeaderParameter" class="xref">Section 3.2</a>
</li>
</ul>

<p> </p>

<ul>
<li>Header Parameter Name: <samp>signers</samp>
</li>
<li>Header Parameter Description: List of signature constructs, each with a set of Header Parameters and a signature value</li>
<li>Header Parameter Usage Location(s): <samp>Cleartext JWS</samp>
</li>
<li>Change Controller: IESG</li>
<li>Specification Document(s): <a href="#SignersHeaderParameter" class="xref">Section 3.3</a>
</li>
</ul>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">The same security considerations apply to this specification as do for JWS <a href="#RFC7515" class="xref">[RFC7515]</a>.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="JCS">[JCS]</b></td>
<td class="top">"<a href="https://cyberphone.github.io/doc/security/draft-rundgren-json-canonicalization-scheme.html">JCS - JSON Canonicalization Scheme</a>"</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7515">[RFC7515]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7517">[RFC7517]</b></td>
<td class="top">
<a>Jones, M.</a>, "<a href="https://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a>", RFC 7517, DOI 10.17487/RFC7517, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7518">[RFC7518]</b></td>
<td class="top">
<a>Jones, M.</a>, "<a href="https://tools.ietf.org/html/rfc7518">JSON Web Algorithms (JWA)</a>", RFC 7518, DOI 10.17487/RFC7518, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8259">[RFC8259]</b></td>
<td class="top">
<a>Bray, T.</a>, "<a href="https://tools.ietf.org/html/rfc8259">The JavaScript Object Notation (JSON) Data Interchange Format</a>", STD 90, RFC 8259, DOI 10.17487/RFC8259, December 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="IANA.JOSE.Algorithms">[IANA.JOSE.Algorithms]</b></td>
<td class="top">
<a>IANA</a>, "<a href="https://www.iana.org/assignments/jose/jose.xhtml#web-signature-encryption-algorithms">JSON Web Signature and Encryption Algorithms</a>"</td>
</tr>
<tr>
<td class="reference"><b id="IANA.JOSE.HeaderParameters">[IANA.JOSE.HeaderParameters]</b></td>
<td class="top">
<a>IANA</a>, "<a href="https://www.iana.org/assignments/jose/jose.xhtml#web-signature-encryption-header-parameters">JSON Web Signature and Encryption Header Parameters</a>"</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#TestVectors" id="TestVectors">Test Vectors</a>
</h1>
<p id="rfc.section.A.p.1">This section contains a set of test vectors.  (Line breaks within values are for display purposes only.) </p>
<h1 id="rfc.appendix.A.1">
<a href="#rfc.appendix.A.1">A.1.</a> <a href="#multipleglobalalg" id="multipleglobalalg">Multiple Signatures with Top-Level "alg" Header Parameter</a>
</h1>
<pre>{
  "iss": "joe",
  "exp": 1300819380,
  "__cleartext_signature": {
    "alg": "ES512",
    "signers": [{
      "kid": "example.com:p256",
      "signature": "zjf2MzEesdIudTk0k9osa0um5ffzU-oM_8Z-mKHFmZxCRvpl4
                    1lX2KUt5a742px_cTsG7sw-Kh8_xJuUMX97Kg"
    },{
      "kid": "example.com:p384",
      "signature": "jTWnzmAcC34zOpTvvg7vuqLECUOqS6UMQcjwM24w7DwHz7nXQ
                    e17eFYTjJWE-w_Nnw3sosYM6c6J9ABFOGoKx70cRPNQQ8WHfT
                    zAyfTBxMBWtUR5PKWi5hJWUDeMnRS0"
    }]
  }
}</pre>
<p></p>
<p id="rfc.section.A.1.p.2">The first signature can be verified using the key in <a href="#example.com:p256" class="xref">Appendix A.3</a> and the second signature can be verified using the key in <a href="#example.com:p384" class="xref">Appendix A.4</a>.  </p>
<h1 id="rfc.appendix.A.2">
<a href="#rfc.appendix.A.2">A.2.</a> <a href="#multipleglobalcrit" id="multipleglobalcrit">Multiple Signatures with Top-Level "crit" Header Parameter</a>
</h1>
<pre>{
  "iss": "joe",
  "exp": 1300819380,
  "__cleartext_signature": {
    "crit": ["otherExt","https://example.com/extension"],
    "signers": [{
      "alg": "ES256",
      "kid": "example.com:p256",
      "otherExt": "Other Data",
      "signature": "S9PqQU5z5zThIGUvErzf7oo8EetiUFEI1v8flisWJzw0HqqY-
                    OuT_pDq1rG4gsSRAFjrazurl4NGyyxcPfeXzw"
    },{
      "alg": "RS256",
      "kid": "example.com:r2048",
      "otherExt": "Cool Stuff",
      "https://example.com/extension": {
        "life-is-great": true
      },
      "signature": "O-cnYTtgvyGmgX1YMQkcnRE0lnBw1EduMNVpdblKP-Iy0S143
                    BBvXrCQoEW9oTkQm7X9wkJoohWQyU4qvojoxQxmf6GQ0tEXEI
                    HqN7ixkPh_3ySXTl-gKTPiA5UL-GV44AS-k6N71qp8XhLORmU
                    m68UlTWBZaOXL0JTGjsCyGpuwNiAQbx39ZbjabvGq4NfpPIQC
                    2yjx_SKoPMiia54Mp0hz8U_S3oyAmHrG2mKFYrJ7k43aeDHK1
                    RNRu8XrW2w-Ffh4KigpClAq4q272ZSsjizfYPPjW3gqInjMZz
                    Qd8yZj5Bi5vCDcBOEKZMDoog-UzIy8SbZNl85TlkhK70oNRQ"
    }]
  }
}</pre>
<p></p>
<p id="rfc.section.A.2.p.2">The first signature can be verified using the key in <a href="#example.com:p256" class="xref">Appendix A.3</a> and the second signature can be verified using the key in <a href="#example.com:r2048" class="xref">Appendix A.5</a>.  </p>
<h1 id="rfc.appendix.A.3">
<a href="#rfc.appendix.A.3">A.3.</a> <a href="#example.com:p256" id="example.com:p256">Elliptic Curve Key "example.com:p256"</a>
</h1>
<p id="rfc.section.A.3.p.1">Elliptic Curve private key, represented as a JWK:</p>
<pre>{
  "kid": "example.com:p256",
  "kty": "EC",
  "crv": "P-256",
  "x": "censDzcMEkgiePz6DXB7cDuwFemshAFR90UNVQFCg8Q",
  "y": "xq8rze6ewG0-eVcSF72J77gKiD0IHnzpwHaU7t6nVeY",
  "d": "nEsftLbi5u9pI8B0-drEjIuJzQgZie3yeqUR3BwWDl4"
}</pre>
<p></p>
<h1 id="rfc.appendix.A.4">
<a href="#rfc.appendix.A.4">A.4.</a> <a href="#example.com:p384" id="example.com:p384">Elliptic Curve Key "example.com:p384"</a>
</h1>
<p id="rfc.section.A.4.p.1">Elliptic Curve private key, represented as a JWK:</p>
<pre>{
  "kid": "example.com:p384",
  "kty": "EC",
  "crv": "P-384",
  "x": "GLfdsvEwphRzS_twup7UFPVOk7_CKgHZ7dt_fJ2QHPBdJa1c5pfJcRIWTfT0l
        pg9",
  "y": "ovA5_QXmFbj9U4pjZ1AX_ZdVyIRZUBWW9cuZda_tupKfWQfmcQHzDmHGHbxl9
        Xxl",
  "d": "Qsgq80kMs40sAn1gB7gLxAk1se37Kmh9AG18wWZ3SqgcPPRq1wwidNTi866Gt
        4_0"
}</pre>
<p></p>
<h1 id="rfc.appendix.A.5">
<a href="#rfc.appendix.A.5">A.5.</a> <a href="#example.com:r2048" id="example.com:r2048">RSA Key "example.com:r2048"</a>
</h1>
<p id="rfc.section.A.5.p.1">RSA private key, represented as a JWK:</p>
<pre>{
  "kid": "example.com:r2048",
  "kty": "RSA",
  "n": "hFWEXArvaZEpSP5qNX7x4C4Hl28GJQTNvnDwkfqiWs63kXbdyPeS06bz6GnY3
        tfQ_093nGauWsimqKBmGAGMPtsV83Qxw1OIeO4ujbIIb9pema0qtVqs0MWlHx
        klZGFkYfAmbuEUFxYDeLDHe0bkkXbSlB7_t8pCSvc8HLgHjEQjYOlFRwjR0D-
        uLo-xgsCbpmCtYkB5lcT_zFgpRgY4zJNLSv7GZiz2S4Fc5ArGjd34lL47-L8b
        ozuYjqNOv9sqX0Zgll5XaJ1ndvr7UqZu1xQFgm38reoM3IarBP_SkEFbt_v9i
        ak602VO3k28fQhMaocP7JWR2YLT3kZM0-WTFw",
  "e": "AQAB",
  "d": "Q6iBYpnIrB2mkQZagP1lZuvBv9_osVaSZpLRvKD7DxhvbDTs0coaTJIoVCSB1
        _VZip8zlUg-TnYWF1Liv9VSwfQ7ddxrcOUtej60mId0ntNz2HhbxJsWjiru8E
        ZoArl0nEovLDNxlRgRMEyZwOKPC_xHT6nFrk7_s9pR5pEEcubGLAVBKnLCoPd
        Lr-CBjCvWfJo73W5AZxoSb8MdWQOi5viXHURpr1Y_uBRsMuclovM56Vt05etM
        sB1AbcTLUDwAuYrZWa1c08ql60ft7b3v6Q_rCL7EHtFU3PHAuP0mV7tM5BfAP
        f4T0g9pbr4GOw7eqQCiYgPFE7gmCR_PDxv5YQ",
  "p": "6DIM343hAtj1hQprJaVQ3T8YeIytIQ7Ma544C0A8BX-irjJfARy4fAlTSyBFe
        auZ0WdbMGtKpAIgNVmfCfuP7W1bXw7UaxpqsQlbw54K1VtBs8xG-lee_2YQ3l
        UlIiC1at6L0jxWYNkvp-LIfU2F5ZQir5ZWVXwgdMcgoNBABMc",
  "q": "keacq0goV7pAtG2h33OAk-XOSclIF1agvEMMOKuud5V-vGQ6OaYldlYqZmSGg
        F7RVlX0GZO70nPqatjd2G-tI8wEq5K_xmLQurUPFW8g___z0CTgJ62KbjFxCt
        Gny5rsObX9im6cCc_EOtWZRaApzO8ykxfo1QcEjT4k1na7DzE",
  "dp": "nPmJPnFal2Q5x_GdMlwq6QhI8OaZ_OlWRcM3PFP2v_jj8ERZehUCm8hqKTXu
         Ai2C1dC8E2XVlj9hqu-l10fcq7Tsurz52laHnpwnD35-8HK7XmRR79jgwuUr
         rkN90S6vt0ow2La15s-tqiBlTmDkjqqxMGfAghZiktA0PMPNI-0",
  "dq": "D3c1lkZw2FPK9hVE-m3A7GyIwHOQq8CoCyzER-GS_eQf6hJpxaCiCfg6SF5R
         j5v9brxvwqJRX46gA7F3WrED1m6S9Cj7ISlqXNBCiBAenGRiUOcHx8zyhpnB
         FNeChOeoMLnk5V6yNawLbf0kYSgIJkwYvVTkfmhfCCXVO9KcI5E",
  "qi": "wV0NzfCakfog1NFjtPzcga1MtkpizgPkxcP9LjNdvXW2YQZhM6GIEGjsu3iv
         TrHrrM-4_bTQHOoTtfIY7wdqBKlwQTJOI0dH9FbNJ4ecGojRwgv83TN8aNKh
         17Tt44jI5oibs2P-31B_VW9R1wwhnnOuCYpABfoSbtHIoCRme5I"
}</pre>
<p></p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.B.p.1">This document builds on the work done in the 
JOSE working group, so a big thanks goes out to all involved in that 
work. It is specifically inspired by JWS, so special thanks are due to 
the authors of that document, Michael B. Jones, John Bradley, and Nat 
Sakimura.  </p>
<p id="rfc.section.B.p.2">Building on ECMAScript number normalization 
was originally proposed by James Manger. This ultimately led to the 
creation of the JCS specification underpinning cleartext JWS.  </p>
<h1 id="rfc.appendix.C">
<a href="#rfc.appendix.C">Appendix C.</a> <a href="#TBD" id="TBD">Open Issues</a>
</h1>
<p id="rfc.section.C.p.1">The following open issues remain to be addressed in this specification.  </p>
<p></p>

<ul>
<li>The signature creation and validation steps for the multiple signatures case needs to be added to <a href="#MessageSignatureMACComputation" class="xref">Section 4.1</a> and <a href="#MessageSignatureMACValidation" class="xref">Section 4.2</a>.  </li>
<li>We need to choose consistent wording between "signature construct" 
and "signature object".  Defining terms at the top of the document would
 probably help.  </li>
</ul>

<p> </p>
<h1 id="rfc.appendix.D">
<a href="#rfc.appendix.D">Appendix D.</a> <a href="#History" id="History">Document History</a>
</h1>
<p id="rfc.section.D.p.1">[[ to be removed by the RFC Editor before publication as an RFC ]]</p>
<p id="rfc.section.D.p.2">-00 </p>

<ul><li>Initial version.  </li></ul>

<p> </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Anders Rundgren</span> 
	  <span class="n hidden">
		<span class="family-name">Rundgren</span>
	  </span>
	</span>
	<span class="org vcardline">Independent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Montpellier</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:anders.rundgren.net@gmail.com">anders.rundgren.net@gmail.com</a></span>

<span class="vcardline">URI: <a href="https://www.linkedin.com/in/andersrundgren/">https://www.linkedin.com/in/andersrundgren/</a></span>

  </address>
</div>



</body></html>